<!DOCTYPE html>
<html>

<head>
    <title>Demo</title>
    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/sprintf.js"></script>
    <script type="text/javascript" src="js/web3.js"></script>
    <script type="text/javascript" src="data/SLS_ABI.js"></script>
    <script type="text/javascript" src="data/ETHERDELTA_ABI.js"></script>
    <script type="text/javascript">
    window.onload = function() {
        if (typeof web3 !== 'undefined') {
            web3 = new Web3(web3.currentProvider);
        } else {
            // set the provider you want from Web3.providers
            web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
        }
        setInterval(function() {
            $("#account").text(sprintf("Account: %s", web3.eth.accounts[0]));

            web3.eth.getBalance(web3.eth.accounts[0], 'latest', function(err, result) {
                if (err) {
                    alert(err);
                } else {
                    $("#ethInWallet").text(sprintf("ETH in wallet: %s", result));
                }
            })

            var sls = web3.eth.contract(sls_abi).at(sls_address);

            sls.balanceOf(web3.eth.accounts[0], function(err, result) {
                if (err) {
                    alert(err);
                } else {
                    $("#slsInWallet").text(sprintf("SLS in wallet: %s", result));
                }
            });

            var etherDelta = web3.eth.contract(etherdelta_abi).at(etherdelta_address);

            etherDelta.tokens(0, web3.eth.accounts[0], function(err, result) {
                if (err) {
                    alert(err);
                } else {
                    $("#ethTokenInEtherDelta").text(sprintf("ETH Token in EtherDelta: %s", result));
                }
            });

            etherDelta.tokens(sls_address, web3.eth.accounts[0], function(err, result) {
                if (err) {
                    alert(err);
                } else {
                    $("#slsTokenInEtherDelta").text(sprintf("SLS Token in EtherDelta: %s", result));
                }
            });

        }, 1000);
    }

    function btn_deposit() {
        var etherDelta = web3.eth.contract(etherdelta_abi).at(etherdelta_address);
        etherDelta.deposit({ value: web3.toWei(1, 'ether') }, function(err, result) {
            console.log("deposit", result);
            if (err) {
                alert(err);
            }
        });
    }

    function btn_withdraw() {
        var etherDelta = web3.eth.contract(etherdelta_abi).at(etherdelta_address);
        etherDelta.withdraw(web3.toWei(1, 'ether'), function(err, result) {
            console.log("withdraw", result);
            if (err) {
                alert(err);
            }
        });
    }

    function btn_approve() {
        var sls = web3.eth.contract(sls_abi).at(sls_address);
        sls.approve(etherdelta_address, 100000000, function(err, result) {
            if (err) {
                alert(err);
            } else {
                console.log("approveToken", result);
            }
        });
    }

    function btn_depositToken() {
        var etherDelta = web3.eth.contract(etherdelta_abi).at(etherdelta_address);
        etherDelta.depositToken(sls_address, 100000000, function(err, result) {
            if (err) {
                alert(err);
            } else {
                console.log("depositToken", result);
            }
        });
    }

    function btn_withdrawToken() {
        var etherDelta = web3.eth.contract(etherdelta_abi).at(etherdelta_address);
        etherDelta.withdrawToken(sls_address, 100000000, function(err, result) {
            if (err) {
                alert(err);
            } else {
                console.log("withdrawToken", result);
            }
        });
    }
    </script>
</head>

<body>
    <div id="account"></div>
    <br/>
    <div id="ethInWallet"></div>
    <div id="slsInWallet"></div>
    <br/>
    <div id="ethTokenInEtherDelta"></div>
    <div id="slsTokenInEtherDelta"></div>
    <hr/>
    <button type="button" onclick="btn_deposit()">deposit 1ETH</button>
    <button type="button" onclick="btn_withdraw()">withdraw 1ETH</button>
    <hr/>
    <button type="button" onclick="btn_approve()">approve 1SLS</button>
    <button type="button" onclick="btn_depositToken()">depositToken 1SLS</button>
    <button type="button" onclick="btn_withdrawToken()">withdrawToken 1SLS</button>
</body>

</html>