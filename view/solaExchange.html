<!DOCTYPE html>
<html>

<head>
    <!--必須在less.js之前-->
    <link rel="stylesheet/less" type="text/css" href="css/solaExchange.less?{{.Uncache}}">
    <script type='text/javascript' src='js/less.min.js'></script>
    <link rel="stylesheet" type="text/css" href="lib/fontawesome/css/font-awesome.css" />
    <script type="text/javascript" src="js/highstock.js"></script>
    <script type="text/javascript" src="js/highchartsTheme.js?{{.Uncache}}"></script>
    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?key=AIzaSyCQ3UTayHzAcoPXJUM3Ag_-FBxII1o6fNg"></script>
    <script type="text/javascript" src="js/gmaps.js?{{.Uncache}}"></script>
    <script type="text/javascript" src="data/map_style.json?{{.Uncache}}"></script>
    <script type="text/javascript" src="js/Chart.min.js"></script>
    <script type="text/javascript" src="js/sprintf.js"></script>
    <!--script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/web3.min.js"></script>
    <script type="text/javascript" src="js/ethers.js?{{.Uncache}}"></script>
    <script type="text/javascript" src="js/Chart.min.js"></script>
    <script type="text/javascript" src="data/sttwABI.js?{{.Uncache}}"></script>
    <script type="text/javascript" src="data/sttwStoreABI.js?{{.Uncache}}"></script>
    <script type="text/javascript" src="data/sntwABI.js?{{.Uncache}}"></script>
    <script type="text/javascript" src="data/solaExchangeABI.js?{{.Uncache}}"></script>
    <script type="text/javascript" src="data/map_style.json?{{.Uncache}}"></script-->
    <script type="text/javascript">
    $(function() {
        Highcharts.setOptions(Highcharts.theme);
        $.getJSON('https://www.highcharts.com/samples/data/jsonp.php?a=e&filename=aapl-ohlc.json&callback=?', function(data) {

            // create the chart
            Highcharts.stockChart('container', {
                rangeSelector: {
                    selected: 1
                },
                series: [{
                    type: 'candlestick',
                    name: 'SNTW Price',
                    data: data
                }],
                navigator: {
                    enabled: false
                },
                scrollbar: {
                    enabled: false
                }
            });
        });

        var allProject, myBar;

        $.getJSON("https://sola-api.herokuapp.com/api/v1/projects", function(data) {
            allProject = data;
            var testType = 0;
            allProject.forEach(function(item, index) {
                $("#projects tr:last").after(sprintf("<tr data-id='%s'><td>%s</td><td>%s</td><td>%s</td><td>%s</td><td>%s</td></tr>", item.id, "SNTW" + (++testType), item.name, item.date.slice(0, 10), item.capacity, item.decay));

                var p = allProject.find(function(a) {
                    return a.id == item.id;
                });
                p.values = {};
            });
        });
        $.getJSON("https://sola-api.herokuapp.com/api/v1/values", function(json) {
            console.log(json);
            json.forEach(function(item, index) {
                var p = allProject.find(function(a) {
                    return a.id == item.id;
                });

                var dt = item.dt.slice(0, 10);
                var v = p.values[dt];
                if (v) {
                    v += item.value;
                    p.values[dt] = v;
                } else {
                    p.values[dt] = item.value;
                }
            });
            console.log(allProject);
        });

        setTimeout(function() {
            var id = "T0026";
            var p = allProject.find(function(a) {
                return a.id == id;
            });

            var map = new GMaps({
                div: '#map',
                lat: p.coord.lat,
                lng: p.coord.lng,
                zoom: 7,
                mapTypeId: 'satellite',
                options: {
                    styles: mapStyle,
                    mapTypeControl: false,
                    fullscreenControl: false,
                    streetViewControl: false
                }
            });

            var m = map.addMarker({
                lat: p.coord.lat,
                lng: p.coord.lng,
                title: p.name,
                infoWindow: {
                    content: sprintf('<h8>%s</h8><div>裝置容量: %s(kW)</div>', p.name, p.capacity),
                    maxWidth: 100
                }
            });

            console.log(p.values);

            var values = [];
            for (var dt in p.values) {
                values.push({ date: dt, value: p.values[dt] });
            }

            values.sort(function(a, b) {
                if (a.date < b.date) {
                    return -1;
                } else if (a.date > b.date) {
                    return 1;
                } else {
                    return 0;
                }
            });

            var lables = [];
            var datas = [];
            values.forEach(function(item, index) {
                lables.push(item.date);
                datas.push(item.value);
            });

            var ctx = $("#chart-area");
            ctx.empty;

            if (myBar) {
                myBar.destroy();
            }
            myBar = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: lables,
                    datasets: [{
                        label: sprintf('%s - 日發電量(kW)', p.name),
                        data: datas,
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    legend: {
                        display: false
                    },
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    }

                }
            });
        }, 3000);
    });
    </script>
</head>

<body>
    <title>Sola Exchange</title>
    <header>
        <div class="headerLeft">
            <img class="logo" src="img/logo.png">
            <!--select id="sntwTokenSelection">
                <option value="1">SNTW1</option>
                <option value="2">SNTW2</option>
                <option value="3">SNTW3</option>
            </select-->
        </div>
        <div class="headerRight">
            <i class="fa fa-user-o userIcon" aria-hidden="true"></i>
            <label id="userAccount">0xAeD134</label>
        </div>
    </header>
    <main>
        <div class="mainLeft">
            <div class="mainLeft1 block">
                <label class="title">BALANCES</label>
                <div class="content">
                    <div class="balance">
                        <span id="balanceTitle">STTW</span>
                        <span>
                            <span id="balanceValue">100.23</span>
                        <i class="fa fa-minus-circle" aria-hidden="true"></i>
                        <i class="fa fa-plus-circle" aria-hidden="true"></i>
                        </span>
                    </div>
                    <div class="balance">
                        <span id="balanceTitle">SNTW1</span>
                        <span>
                            <span id="balanceValue">50</span>
                        <i class="fa fa-minus-circle" aria-hidden="true"></i>
                        <i class="fa fa-plus-circle" aria-hidden="true"></i>
                        </span>
                    </div>
                    <div class="balance">
                        <span id="balanceTitle">SNTW2</span>
                        <span>
                            <span id="balanceValue">0</span>
                        <i class="fa fa-minus-circle" aria-hidden="true"></i>
                        <i class="fa fa-plus-circle" aria-hidden="true"></i>
                        </span>
                    </div>
                    <div class="balance">
                        <span id="balanceTitle">SNTW3</span>
                        <span>
                            <span id="balanceValue">0</span>
                        <i class="fa fa-minus-circle" aria-hidden="true"></i>
                        <i class="fa fa-plus-circle" aria-hidden="true"></i>
                        </span>
                    </div>
                </div>
            </div>
            <div class="mainLeft2 block">
                <label class="title">NEW ORDER</label>
                <div class="content">
                    <div class="input">
                        <span class="inputTitle">Amount</span>
                        <input type="number" value=0></input>
                        <span class="inputUnit">SNTW</span>
                    </div>
                    <div class="input">
                        <span class="inputTitle">Price</span>
                        <input type="number" value=0></input>
                        <span class="inputUnit">STTW</span>
                    </div>
                    <div class="input">
                        <span class="inputTitle">Expires</span>
                        <input type="number" value=0></input>
                        <span class="inputUnit">Blocks</span>
                    </div>
                    <div class="input">
                        <span class="inputTitle">Sub-total</span>
                        <input type="number" value=0></input>
                        <span class="inputUnit">STTW</span>
                    </div>
                    <div class="input">
                        <span class="inputTitle">Commission</span>
                        <input type="number" value=0></input>
                        <span class="inputUnit">STTW</span>
                    </div>
                    <div class="input">
                        <span class="inputTitle">Total</span>
                        <input type="number" value=0></input>
                        <span class="inputUnit">STTW</span>
                    </div>
                    <div class="orderButton">
                        <div class="buy">Buy</div>
                        <div class="sell">Sell</div>
                    </div>
                </div>
            </div>
            <div class="mainLeft3 block">
                <label class="title">MY TRADE HISTORY</label>
                <div class="content scrollbar">
                    <div class="table">
                        <div class="rowHead">
                            <div class="cell">Order</div>
                            <div class="cell">Pair</div>
                            <div class="cell">Price</div>
                            <div class="cell">Amount</div>
                        </div>
                        <div class="row sell">
                            <div class="cell">SELL</div>
                            <div class="cell">SNTW</div>
                            <div class="cell">9.5</div>
                            <div class="cell">20</div>
                        </div>
                        <div class="row buy">
                            <div class="cell">BUY</div>
                            <div class="cell">SNTW</div>
                            <div class="cell">9.2</div>
                            <div class="cell">50</div>
                        </div>
                        <div class="row buy">
                            <div class="cell">BUY</div>
                            <div class="cell">SNTW</div>
                            <div class="cell">9.2</div>
                            <div class="cell">30</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="mainRight">
            <div class="mainRight1">
                <div class="mainRight1Left">
                    <div class="mainRight1Left1 block">
                        <label class="title">PAIRS</label>
                        <div class="content scrollbar">
                            <div class="table">
                                <div class="rowHead">
                                    <div class="cell">Pair</div>
                                    <div class="cell">Name</div>
                                    <div class="cell">Initial Date</div>
                                    <div class="cell">Capacity</div>
                                    <div class="cell">Decay</div>
                                    <div class="cell">Health</div>
                                </div>
                                <div class="row pair">
                                    <div class="cell">SNTW1</div>
                                    <div class="cell">鹽水牛舍</div>
                                    <div class="cell">2016-12-30</div>
                                    <div class="cell">99</div>
                                    <div class="cell">0.007</div>
                                    <div class="cell">95%</div>
                                </div>
                                <div class="row pair">
                                    <div class="cell">SNTW2</div>
                                    <div class="cell">金紜鋼鐵</div>
                                    <div class="cell">2016-12-30</div>
                                    <div class="cell">60.78</div>
                                    <div class="cell">0.007</div>
                                    <div class="cell">99%</div>
                                </div>
                                <div class="row pair">
                                    <div class="cell">SNTW3</div>
                                    <div class="cell">鹽水豬舍</div>
                                    <div class="cell">2016-12-30</div>
                                    <div class="cell">39.6</div>
                                    <div class="cell">0.007</div>
                                    <div class="cell">92%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mainRight1Left2 block">
                        <label class="title">POWER GENERATION</label>
                        <canvas id="chart-area" class="zone"></canvas>
                    </div>
                </div>
                <div class="mainRight1Right block">
                    <label class="title">LOCATION</label>
                    <div class="content">
                        <div id="map" class="map">
                        </div>
                    </div>
                </div>
            </div>
            <div class="mainRight2">
                <div class="mainRight2Right block">
                    <label class="title">OPEN ORDERS</label>
                    <div class="content scrollbar">
                        <div class="table">
                            <div class="rowHead">
                                <div class="cell">Order</div>
                                <div class="cell">Pair</div>
                                <div class="cell">Price</div>
                                <div class="cell">Units Filled</div>
                                <div class="cell">Units Total</div>
                                <div class="cell">Status</div>
                            </div>
                            <div class="row buy">
                                <div class="cell">BUY</div>
                                <div class="cell">SNTW</div>
                                <div class="cell">9.2</div>
                                <div class="cell">0</div>
                                <div class="cell">100</div>
                                <div class="cell">alive</div>
                            </div>
                            <div class="row sell">
                                <div class="cell">SELL</div>
                                <div class="cell">SNTW</div>
                                <div class="cell">9.5</div>
                                <div class="cell">20</div>
                                <div class="cell">50</div>
                                <div class="cell">alive</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mainRight2Left block">
                    <label class="title">ORDER BOOK</label>
                    <div id="orderBook" class="content">
                        <div class="orderBookBuy">
                            <div class="table">
                                <div class="rowHead">
                                    <div class="cell">Amount</div>
                                    <div class="cell">Total</div>
                                    <div class="cell">Price</div>
                                </div>
                                <div class="row">
                                    <div class="cell">1</div>
                                    <div class="cell">100</div>
                                    <div class="cell">9.2</div>
                                </div>
                                <div class="row">
                                    <div class="cell">2</div>
                                    <div class="cell">200</div>
                                    <div class="cell">9.1</div>
                                </div>
                                <div class="row">
                                    <div class="cell">3</div>
                                    <div class="cell">300</div>
                                    <div class="cell">9.0</div>
                                </div>
                                <div class="row">
                                    <div class="cell">4</div>
                                    <div class="cell">400</div>
                                    <div class="cell">8.9</div>
                                </div>
                                <div class="row">
                                    <div class="cell">5</div>
                                    <div class="cell">500</div>
                                    <div class="cell">8.8</div>
                                </div>
                                <div class="row">
                                    <div class="cell">6</div>
                                    <div class="cell">600</div>
                                    <div class="cell">8.7</div>
                                </div>
                                <div class="row">
                                    <div class="cell">7</div>
                                    <div class="cell">700</div>
                                    <div class="cell">8.6</div>
                                </div>
                            </div>
                        </div>
                        <div class="orderBookSell">
                            <div class="table">
                                <div class="rowHead">
                                    <div class="cell">Price</div>
                                    <div class="cell">Total</div>
                                    <div class="cell">Amount</div>
                                </div>
                                <div class="row">
                                    <div class="cell">9.3</div>
                                    <div class="cell">10</div>
                                    <div class="cell">1</div>
                                </div>
                                <div class="row">
                                    <div class="cell">9.5</div>
                                    <div class="cell">20</div>
                                    <div class="cell">2</div>
                                </div>
                                <div class="row">
                                    <div class="cell">9.6</div>
                                    <div class="cell">30</div>
                                    <div class="cell">3</div>
                                </div>
                                <div class="row">
                                    <div class="cell">9.7</div>
                                    <div class="cell">40</div>
                                    <div class="cell">4</div>
                                </div>
                                <div class="row">
                                    <div class="cell">9.8</div>
                                    <div class="cell">50</div>
                                    <div class="cell">5</div>
                                </div>
                                <div class="row">
                                    <div class="cell">9.9</div>
                                    <div class="cell">60</div>
                                    <div class="cell">6</div>
                                </div>
                                <div class="row">
                                    <div class="cell">10.0</div>
                                    <div class="cell">70</div>
                                    <div class="cell">7</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mainRight3 block">
                <label class="title">CHART</label>
                <div class="content chart">
                    <div id="container" style="width:100%"></div>
                </div>
            </div>
        </div>
    </main>
    <footer>
        <div class="block">
            <label>Copy Right & Other Information</label>
        </div>
    </footer>
</body>

</html>